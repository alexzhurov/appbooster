import { Action }      from 'redux';
import { ThunkAction } from 'redux-thunk';
import { getRates }    from '../store/rates/actions';
import { AppState }    from '../store';
import { IRatesState } from '../store/rates/types';
import axios           from 'axios';
import {
  API_CURR_KEY,
  API_INFO
}                      from '../constants';

export const thunkGetRates = (base: string): ThunkAction<void, AppState, null, Action<string>> => async dispatch => {
  const result = await apiRates(base);
  dispatch(getRates(result));
};

async function apiRates(base: string): Promise<IRatesState> {
  try {
    // Minimize quantity of free responses.
    if (process.env.REACT_APP_IS_MOKABLE) {
      const isLong = true;
      return new Promise(resolve => resolve({
        timestamp: 1576242000,
        base: "USD",
        rates: {
          ...(isLong ? {
            AED: 3.673138,
            AFN: 78.51785,
            ALL: 109.5496,
            AMD: 477.872478,
            ANG: 1.704304,
            AOA: 469.3135,
            ARS: 59.7608,
            AUD: 1.447152,
            AWG: 1.8,
            AZN: 1.7025,
            BAM: 1.750818,
            BBD: 2,
            BDT: 84.928378,
            BGN: 1.749655,
            BHD: 0.377024,
            BIF: 1876.492216,
            BMD: 1,
            BND: 1.352102,
            BOB: 6.913274,
            BRL: 4.087438,
            BSD: 1,
            BTC: 0.000138479388,
            BTN: 70.756412,
            BWP: 10.785296,
            BYN: 2.100678,
            BZD: 2.015118,
            CAD: 1.31693,
            CDF: 1665.632853,
            CHF: 0.982607,
            CLF: 0.026239,
            CLP: 768.7,
            CNH: 6.975725,
            CNY: 6.978,
            COP: 3373.673808,
            CRC: 568.608604,
            CUC: 1,
            CUP: 25.75,
            CVE: 99.625,
            CZK: 22.83102,
            DJF: 178.05,
            DKK: 6.689563,
            DOP: 52.875605,
            DZD: 119.272947,
            EGP: 16.1206,
            ERN: 14.999618,
            ETB: 31.670706,
            EUR: 0.895138,
            FJD: 2.16645,
            FKP: 0.74691,
            GBP: 0.74691,
            GEL: 2.88,
            GGP: 0.74691,
            GHS: 5.698439,
            GIP: 0.74691,
            GMD: 51.26,
            GNF: 9535.420239,
            GTQ: 7.672944,
            GYD: 208.617576,
            HKD: 7.791285,
            HNL: 24.618687,
            HRK: 6.6593,
            HTG: 96.791118,
            HUF: 294.398699,
            IDR: 14007,
            ILS: 3.48205,
            IMP: 0.74691,
            INR: 70.775496,
            IQD: 1193.505789,
            IRR: 42105,
            ISK: 122.580012,
            JEP: 0.74691,
            JMD: 140.55937,
            JOD: 0.709,
            JPY: 109.52316667,
            KES: 101.7,
            KGS: 69.669951,
            KHR: 4066.988189,
            KMF: 442.761616,
            KPW: 900,
            KRW: 1172.249983,
            KWD: 0.303268,
            KYD: 0.833128,
            KZT: 384.622268,
            LAK: 8864.240343,
            LBP: 1511.847173,
            LKR: 181.053771,
            LRD: 187.999995,
            LSL: 14.609501,
            LYD: 1.398846,
            MAD: 9.582771,
            MDL: 17.278712,
            MGA: 3679.513308,
            MKD: 55.080376,
            MMK: 1509.112583,
            MNT: 2698.122578,
            MOP: 8.024619,
            MRO: 357,
            MRU: 37.612381,
            MUR: 36.450484,
            MVR: 15.45,
            MWK: 736.202241,
            MXN: 19.03326,
            MYR: 4.1346,
            MZN: 63.949995,
            NAD: 14.609501,
            NGN: 363.653057,
            NIO: 33.726351,
            NOK: 9.013421,
            NPR: 113.209931,
            NZD: 1.511246,
            OMR: 0.384994,
            PAB: 1,
            PEN: 3.376169,
            PGK: 3.408553,
            PHP: 50.53,
            PKR: 155.000535,
            PLN: 3.824317,
            PYG: 6433.875926,
            QAR: 3.641,
            RON: 4.2778,
            RSD: 105.115,
            RUB: 62.630667,
            RWF: 934.465013,
            SAR: 3.750142,
            SBD: 8.223345,
            SCR: 13.697821,
            SDG: 45.09907,
            SEK: 9.360986,
            SGD: 1.352322,
            SHP: 0.74691,
            SLL: 7479.71008,
            SOS: 578.342252,
            SRD: 7.458,
            SSP: 130.26,
            STD: 21560.79,
            STN: 22.25,
            SVC: 8.748043,
            SYP: 515.064968,
            SZL: 14.604756,
            THB: 30.19,
            TJS: 9.6784,
            TMT: 3.51,
            TND: 2.8515,
            TOP: 2.301038,
            TRY: 5.803283,
            TTD: 6.747417,
            TWD: 30.220998,
            TZS: 2297.37941,
            UAH: 23.479983,
            UGX: 3672.051353,
            USD: 1,
            UYU: 37.799509,
            UZS: 9522.496225,
            VEF: 248487.642241,
            VES: 31174.355,
            VND: 23180.232766,
            VUV: 115.77911,
            WST: 2.63418,
            XAF: 587.171762,
            XAG: 0.05882534,
            XAU: 0.00067906,
            XCD: 2.70255,
            XDR: 0.724566,
            XOF: 587.171762,
            XPD: 0.00050609,
            XPF: 106.818327,
            XPT: 0.001062,
            YER: 250.349961,
            ZAR: 14.455374,
            ZMW: 14.52109,
            ZWL: 322.000001
          } : {
            AED: 3.672538,
            AFN: 66.809999,
            ALL: 125.716501,
            AMD: 484.902502,
            ANG: 1.788575,
            AOA: 135.295998,
            ARS: 9.750101,
            AUD: 1.390866
          })
        }
      }));
    } else {
      const { data } = await axios.get(API_INFO, {
        params: { app_id: API_CURR_KEY, base }
      });
      return {
        timestamp: data.timestamp,
        base: data.base,
        rates: data.rates
      };
    }
  } catch (error) {
    throw error;
  }
}

